<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Horária • 2026.1</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">

    <style>
        .shift-btn.active-int {
            background: rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.5);
            color: #fff;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
        }
        .shift-btn.active-ves {
            background: rgba(234, 179, 8, 0.2);
            border-color: rgba(234, 179, 8, 0.5);
            color: #fff;
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.3);
        }
        /* Estilo para os Selects do Filtro */
        .filter-select {
            padding: 8px 12px; 
            border-radius: 8px; 
            border: none; 
            background: rgba(255,255,255,0.9); 
            color: #0f172a; 
            font-weight: 600; 
            cursor: pointer; 
            outline: none;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <div class="parallax" aria-hidden="true">
        <div class="layer l1"></div>
        <div class="layer l2"></div>
        <div class="layer l3"></div>
    </div>
    <div class="grain" aria-hidden="true"></div>

    <main class="wrap">
        <header class="hero glass">
            <div class="hero-top">
                <div class="hero-title">
                    <div>
                        <h1>Grade Horária</h1>
                        <div class="meta">
                            <span class="pill">
                                <i class="fa-solid fa-user-tie"></i> 
                                Coordenação: <%= cursoDetalhes && cursoDetalhes.coordenador ? cursoDetalhes.coordenador : 'Geral / Todos' %>
                            </span>
                            <span class="pill"><i class="fa-solid fa-calendar"></i> 2026.1</span>
                            <% if(unidadeSelecionada) { %>
                                <span class="pill"><i class="fa-solid fa-location-dot"></i> <%= unidadeSelecionada %></span>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <form action="/" method="GET" style="margin-top: 20px;">
                <div class="glass-soft" style="padding: 15px; display: inline-flex; flex-wrap: wrap; gap: 15px; align-items: center; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                    
                    <div class="d-flex flex-column">
                        <label style="color: rgba(255,255,255,0.8); font-size: 0.8rem; margin-bottom: 4px;">Unidade:</label>
                        <select name="unidade" class="filter-select" onchange="this.form.submit()">
                            <option value="">-- Todas as Unidades --</option>
                            <% unidades.forEach(u => { %>
                                <option value="<%= u.unidade %>" <%= unidadeSelecionada == u.unidade ? 'selected' : '' %>>
                                    <%= u.unidade %>
                                </option>
                            <% }) %>
                        </select>
                    </div>

                    <div class="d-flex flex-column">
                        <label style="color: rgba(255,255,255,0.8); font-size: 0.8rem; margin-bottom: 4px;">Curso:</label>
                        <select name="curso_id" class="filter-select" onchange="this.form.submit()">
                            <option value="">-- Todos os Cursos --</option>
                            <% cursos.forEach(c => { %>
                                <option value="<%= c.id %>" <%= cursoSelecionado == c.id ? 'selected' : '' %>>
                                    <%= c.nome %>
                                </option>
                            <% }) %>
                        </select>
                    </div>

                </div>
            </form>

            <% if (turnos && turnos.length > 0) { %>
                <div class="controls glass-soft" role="tablist" style="margin-top: 15px;">
                    <% turnos.forEach((turno, index) => { %>
                        <button class="shift-btn <%= index === 0 ? 'active-' + (turno.slug || 'gen').substring(0,3) : '' %>" 
                                id="btn-<%= turno.slug %>" 
                                onclick="showShift('<%= turno.slug %>')">
                            <i class="fa-solid <%= turno.icone %>"></i> <%= turno.nome %>
                        </button>
                    <% }) %>
                </div>
            <% } %>
        </header>

        <% if (turnos && turnos.length > 0) { %>
            <% turnos.forEach((turno, index) => { %>
                <section id="<%= turno.slug %>" class="shift-container <%= turno.tema_class %> <%= index === 0 ? 'active' : '' %>">
                    
                    <% const turmasDoTurno = turmas.filter(t => t.turno === turno.slug); %>
                    
                    <% if (turmasDoTurno.length === 0) { %>
                        <div class="glass" style="padding: 40px; text-align: center; margin-top: 20px; color: rgba(255,255,255,0.7);">
                            <i class="fa-solid fa-ghost fa-2x mb-3"></i><br>
                            Nenhuma turma cadastrada para o turno <%= turno.nome %> com estes filtros.
                        </div>
                    <% } %>

                    <% turmasDoTurno.forEach(turma => { %>
                        <article class="class-infographic-card glass">
                            <div class="infographic-header">
                                <div class="class-ident">
                                    <div class="class-icon-box" style="background: var(--<%= (turno.slug || 'gen').substring(0,3) %>-gradient, linear-gradient(135deg, #64748b, #94a3b8));">
                                        <i class="fa-solid fa-graduation-cap"></i>
                                    </div>
                                    <div>
                                        <div class="class-title"><%= turma.nome %></div>
                                        <div class="class-semesters">
                                            <i class="fa-solid fa-layer-group"></i> Semestre: <%= turma.semestre || 'Geral' %>
                                            <span style="opacity: 0.6; margin-left: 8px;">| <i class="fa-solid fa-map-pin"></i> <%= turma.unidade %></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="weekly-load">
                                    <% const diasOcupados = turma.dias.filter(d => !d.livre).length; %>
                                    <span class="load-label">Ocupação: <%= diasOcupados %>/5 Dias</span>
                                    <div class="load-bar">
                                        <div class="load-fill" style="width:<%= (diasOcupados/5)*100 %>%"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="week-modules-grid">
                                <% turma.dias.forEach(dia => { %>
                                    <div class="day-module <%= dia.livre ? 'empty-day' : 'has-class' %>">
                                        <div class="day-header">
                                            <%= dia.dia %> <i class="fa-solid <%= dia.icone || 'fa-calendar' %>"></i>
                                        </div>
                                        
                                        <div class="subject-info">
                                            <% if (dia.livre) { %>
                                                <span style="opacity: 0.7;">Sem aula</span>
                                            <% } else { %>
                                                <div class="subject-name"><%= dia.disciplina %></div>
                                                <div class="d-flex justify-content-between align-items-center mt-1">
                                                    <div class="prof-badge">
                                                        <i class="fa-solid fa-chalkboard-user"></i> <%= dia.prof %>
                                                    </div>
                                                    <% if (dia.sala) { %>
                                                        <div class="room-badge" style="font-size: 0.75rem; background: rgba(255,255,255,0.25); padding: 2px 8px; border-radius: 4px;">
                                                            <i class="fa-solid fa-door-open"></i> <%= dia.sala %>
                                                        </div>
                                                    <% } %>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        </article>
                    <% }) %>
                </section>
            <% }) %>
        <% } else { %>
            <div class="glass" style="padding: 50px; text-align: center; margin-top: 30px;">
                <h2 style="color: #fff;">Nenhuma grade encontrada</h2>
                <p>Não há aulas correspondentes aos filtros selecionados.</p>
                <a href="/" class="shift-btn" style="display:inline-block; width:auto; margin-top:15px;">Limpar Filtros</a>
            </div>
        <% } %>
        
        <footer class="glass">
            <div class="footer-grid">
                <div class="footer-small" style="text-align: center; width: 100%; opacity: 0.6;">
                    Sistema Acadêmico v1.0
                </div>
            </div>
        </footer>
    </main>

    <script>
        function showShift(shiftSlug) {
            document.querySelectorAll(".shift-container").forEach(el => el.classList.remove("active"));
            
            const btns = document.querySelectorAll(".shift-btn");
            btns.forEach(btn => {
                const classes = btn.className.split(" ").filter(c => !c.startsWith("active-"));
                btn.className = classes.join(" ");
            });

            const target = document.getElementById(shiftSlug);
            if(target) target.classList.add("active");

            const activeBtn = document.getElementById("btn-" + shiftSlug);
            if(activeBtn && shiftSlug) {
                const prefix = shiftSlug.substring(0, 3); 
                activeBtn.classList.add("active-" + prefix);
            }
        }

        const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)");
        function updateParallax() {
            if (prefersReduced.matches) return;
            const y = window.scrollY || 0;
            document.documentElement.style.setProperty("--p1", y + "px");
            document.documentElement.style.setProperty("--p2", y + "px");
            document.documentElement.style.setProperty("--p3", y + "px");
        }
        window.addEventListener("scroll", updateParallax, { passive: true });
    </script>
</body>
</html>